﻿@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@using RenderGalleyRazor.Models;
@inject RenderGalleyRazor.Models.DatabaseContext dbContext
@model VMEditar

@{
    var user_id = 0;

    if (SignInManager.IsSignedIn(User))
    {
        var user = dbContext.Users.Where(x => x.Email == User.Identity.Name).FirstOrDefault();
        user_id = user.Id;
    }
    var users = dbContext.Users.Where(x => x.Id == user_id).FirstOrDefault();

}

<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
<link rel="stylesheet" href="~/css/perfil.css">

<div class="container">
    <div class="row justify-content-center">
        <div class="col-6 uxa-form-group mt-5">

            <h1 class="text-center mt-5 mb-2">@users.Name</h1>
            <!-- single sentence description -->
            <p class="lead text-center">@User.Identity.Name</p>
            <!-- /single sentence description -->
            <!-- Adicione um ID à div de avatar para referenciá-la facilmente no JavaScript e CSS -->
            <div class="uxa-user-avatar" id="avatarContainer" onmouseover="showChangeImageButton()" onmouseout="hideChangeImageButton()">
                <img id="userAvatar" src="~/@users.Pic" alt="User avatar">
                <button type="button" class="btn btn-link" id="changeImageButton" onclick="openFileSelector()"></button>
                <!-- Botão para trocar a imagem -->
            </div>

            <form class="mt-5 mb-5" id="accountDetailsForm" method="post" EncType="multipart/form-data" action="/Account/Editar">

                <!-- Adiciona um campo de input para a imagem, mas o mantém oculto -->

                <input asp-for="File" type="file" class="form-control-file" id="avatarInput" accept="image/" style="display: none" onchange="previewImage(this)">
                <span asp-validation-for="Error" class="text-danger"></span>

                <div class="form-group">
                    <label for="Email">Email<span></span></label>
                    <input asp-for="Email" type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="ex: example@gmail.com" value="@users.Email" style="pointer-events: none;">
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label for="Nome">Nome<span></span></label>
                    <input asp-for="Nome" type="text" class="form-control" id="exampleInputName" aria-describedby="emailHelp" placeholder="ex: João Vitor" value="@users.Name">
                    <span asp-validation-for="Nome" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label for="Telefone">Celular<span></span></label>
                    <input asp-for="Telefone" type="tel" class="form-control" id="exampleInputCelular" aria-describedby="emailHelp" placeholder="" value="@users.Telefone">
                    <span asp-validation-for="Telefone" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label for="Password">Senha Antiga<span></span></label> 
                    <input asp-for="Password" type="password" class="form-control" id="exampleInputSenha" aria-describedby="emailHelp" placeholder="" value="">
                    <span asp-validation-for="Password" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label for="NewPassword">Nova Senha<span></span></label>
                    <input asp-for="NewPassword" type="password" class="form-control" id="exampleInputConfirmSenha" aria-describedby="emailHelp" placeholder="" value="">
                    <span asp-validation-for="NewPassword" class="text-danger"></span>
                </div>

                <button formaction="~/Account/Editar" class="button-login btn-login" type="submit">Atualizar detalhes da conta</button>
            </form>


        </div>
    </div>
</div>
<!-- partial -->
<script src="~/js/perfil.js"></script>
<script>
    window.onload = function () {
    @if (ViewBag.success != null && (bool)ViewBag.success)
    {
        <text>
                Swal.fire({
                    title: "Sucesso!",
                    text: "Alterações Salvas!",
                    icon: "success"
                });

            setTimeout(() => {
                window.location.href = "/Home";
            }, "1000");
        </text>
    }

    }
</script>